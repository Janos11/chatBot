<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ollama Streaming Example</title>

  <style>
    #output {
      white-space: pre-wrap;
      border: 1px solid #ccc;
      padding: 1em;
      max-width: 600px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      background: #f9f9f9;
    }
    button {
      padding: 0.5em 1em;
      font-size: 1rem;
      margin-bottom: 1em;
      cursor: pointer;
    }
  </style>
</head>



<body>

  <button id="generateBtn">Generate Response</button>
  <div id="output"></div>

  <script>
    async function generate() {
      const outputDiv = document.getElementById('output');
      outputDiv.textContent = ''; // clear previous output

      const response = await fetch('http://192.168.1.189:85/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'tinyllama',
          prompt: 'test',
        }),
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder('utf-8');

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value);

        // The response is a stream of JSON objects per line
        chunk.split('\n').forEach(line => {
          if (line.trim()) {
            try {
              const obj = JSON.parse(line);
              if (obj.response) {
                outputDiv.textContent += obj.response;
                // Optional: auto-scroll to bottom
                outputDiv.scrollTop = outputDiv.scrollHeight;
              }
            } catch (e) {
              console.error('JSON parse error:', e);
            }
          }
        });
      }
    }

    document.getElementById('generateBtn').addEventListener('click', generate);
  </script>

</body>
</html>
